<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tayvu - Digital Memorials for Your Loved Ones</title>
    <meta
      name="description"
      content="Create beautiful, lasting digital memorials to honor and remember your loved ones. Share memories, photos, and tributes in a compassionate online space."
    />
    <meta
      name="keywords"
      content="digital memorial, online obituary, remembrance, tribute, memorial website"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:wght@300;400&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- LEGACY INLINE CSS REMOVED ‚Äì now lives in src/styles/base.css -->
    <!--
        <style>
        ‚Ä¶ thousands of lines ‚Ä¶
        </style>
        -->
  </head>
  <body>
    <!-- Navigation -->
    <nav role="navigation" aria-label="Main navigation">
      <div class="nav-container">
        <a href="#home" class="logo" data-page="home">
          <img src="/src/assets/svg/tayvu-logo.svg" alt="Tayvu logo" width="240" height="85" />
        </a>

        <ul class="nav-links">
          <li><a href="#home" data-page="home">Home</a></li>
          <li><a href="#about" data-page="about">About</a></li>
          <li><a href="#pricing" data-page="pricing">Pricing</a></li>
          <li><a href="#faq" data-page="faq">FAQ</a></li>
        </ul>

        <div class="auth-buttons">
          <a href="#" class="btn-signin" onclick="openModal('signin')">Sign In</a>
          <button class="profile-btn" data-action="profile" aria-label="Profile">
            <img
              src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop"
              alt="Profile"
              class="profile-btn-img"
              id="navProfilePhoto"
              style="display: none"
            />
            <span class="profile-btn-initial" id="navProfileInitial">U</span>
          </button>
          <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Toggle menu">
            <i class="fas fa-bars"></i>
          </button>
        </div>
      </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
      <ul class="mobile-menu-links">
        <li><a href="#home" data-page="home" onclick="toggleMobileMenu()">Home</a></li>
        <li><a href="#about" data-page="about" onclick="toggleMobileMenu()">About</a></li>
        <li><a href="#pricing" data-page="pricing" onclick="toggleMobileMenu()">Pricing</a></li>
        <li><a href="#faq" data-page="faq" onclick="toggleMobileMenu()">FAQ</a></li>
      </ul>
      <div class="mobile-menu-auth">
        <a href="#" class="btn-signin" onclick="openModal('signin'); toggleMobileMenu()">Sign In</a>
      </div>
    </div>

    <!-- Home Page -->
    <main id="home" class="page-section active">
      <!-- Hero Section -->
      <section class="hero">
        <div class="hero-container">
          <div class="hero-content">
            <h1>Honor Their Memory with <span>Beautiful Digital Tributes</span></h1>
            <p>
              Create lasting TEST online memorials that celebrate lives, preserve memories, and
              bring loved ones together in remembrance.
            </p>
            <div class="hero-buttons">
              <a href="#" class="btn-primary" onclick="goToCreateMemorial()">
                <span>Create Memorial</span>
                <i class="fas fa-arrow-right"></i>
              </a>
            </div>
          </div>
          <div class="hero-image">
            <div class="hero-visual">
              <div class="memorial-card-preview">
                <div class="memorial-card-header">
                  <img
                    src="https://images.unsplash.com/photo-1566616213894-2d4e1baee5d8?w=100&h=100&fit=crop&crop=face"
                    alt="Memorial preview"
                    class="memorial-card-photo"
                  />
                </div>
                <div class="memorial-card-body">
                  <h3 class="memorial-card-name">Margaret Rose Thompson</h3>
                  <p class="memorial-card-dates">1945 - 2023</p>
                  <p class="memorial-card-description">
                    A life filled with love, laughter, and endless compassion...
                  </p>

                  <button class="memorial-card-button" data-page="exampleMemorial">
                    <i class="fas fa-eye"></i>
                    <span>See Example</span>
                  </button>
                </div>
              </div>

              <div class="floating-elements">
                <!-- Add these floating hearts -->
                <span class="floating-heart floating-heart-1">‚ù§Ô∏è</span>
                <span class="floating-heart floating-heart-2">üíï</span>
                <span class="floating-heart floating-heart-3">üíñ</span>
                <span class="floating-heart floating-heart-4">‚ù§Ô∏è</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Features Section -->
      <section class="features">
        <div class="features-container">
          <div class="section-header">
            <h2>Everything You Need to Create Meaningful Memorials</h2>
            <p>
              Our platform blends heartfelt design with intuitive tools to help you celebrate and
              preserve cherished memories.
            </p>
          </div>

          <div class="features-grid">
            <div class="feature-card">
              <div class="feature-icon">
                <i class="fas fa-heart"></i>
              </div>
              <h3>Transparent pricing</h3>
              <p>One-time payment with no hidden fees or recurring charges after that.</p>
            </div>

            <div class="feature-card">
              <div class="feature-icon">
                <i class="fas fa-photo-video"></i>
              </div>
              <h3>No Advertisements</h3>
              <p>Advertisements will never be displayed on memorial pages.</p>
            </div>

            <div class="feature-card">
              <div class="feature-icon">
                <i class="fas fa-users"></i>
              </div>
              <h3>Trusted & Secure</h3>
              <p>Your memories are protected with enterprise-grade security.</p>
            </div>

            <div class="feature-card">
              <div class="feature-icon">
                <i class="fas fa-shield-alt"></i>
              </div>
              <h3>Compassionate Design</h3>
              <p>
                Thoughtfully crafted templates and layouts that honor your loved one's memory with
                dignity, warmth, and beauty.
              </p>
            </div>

            <div class="feature-card">
              <div class="feature-icon">
                <i class="fas fa-infinity"></i>
              </div>
              <h3>Community Tributes</h3>
              <p>
                Friends and family can contribute their own memories, creating a rich tapestry of
                shared experiences.
              </p>
            </div>

            <div class="feature-card">
              <div class="feature-icon">
                <i class="fas fa-mobile-alt"></i>
              </div>
              <h3>Privacy First</h3>
              <p>We never share or sell your data to third parties, period.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- How It Works Section -->
      <section class="how-it-works">
        <div class="how-it-works-container">
          <div class="how-it-works-header animate-fade-in">
            <h2>How It Works</h2>
            <p>
              Creating a beautiful memorial is simple and takes just minutes. Follow these three
              easy steps to honor your loved one.
            </p>
          </div>

          <div class="steps-container">
            <div class="step-card animate-fade-in">
              <div class="step-number">1</div>
              <div class="step-visual">
                <div class="visual-mockup">
                  <div class="mockup-form">
                    <div class="mockup-input"></div>
                    <div class="mockup-input"></div>
                    <div class="mockup-input"></div>
                    <div class="mockup-button"></div>
                  </div>
                </div>
              </div>
              <h3 class="step-title">Sign Up & Share Details</h3>
              <p class="step-description">
                Create your account and tell us about your loved one. Share their name, dates, and
                the story you want to tell.
              </p>
            </div>

            <div class="step-card animate-fade-in">
              <div class="step-number">2</div>
              <div class="step-visual">
                <div class="visual-mockup">
                  <div class="mockup-upload">
                    <div class="mockup-upload-icon">
                      <i class="fas fa-images"></i>
                    </div>
                    <div class="mockup-text"></div>
                    <div class="mockup-text short"></div>
                  </div>
                </div>
              </div>
              <h3 class="step-title">Upload Photos & Memories</h3>
              <p class="step-description">
                Add photos, videos, and stories that capture their spirit. Create a timeline of
                their life's most precious moments.
              </p>
            </div>

            <div class="step-card animate-fade-in">
              <div class="step-number">3</div>
              <div class="step-visual">
                <div class="visual-mockup">
                  <div class="mockup-browser">
                    <div class="mockup-content">
                      <div class="mockup-avatar"></div>
                      <div class="mockup-text"></div>
                      <div class="mockup-text short"></div>
                      <div class="mockup-text"></div>
                    </div>
                  </div>
                </div>
              </div>
              <h3 class="step-title">Share & Celebrate</h3>
              <p class="step-description">
                Your beautiful memorial is ready to share. Invite family and friends to contribute
                their own memories and tributes.
              </p>
            </div>
          </div>

          <div class="cta-section">
            <div class="cta-content">
              <h3 class="cta-title">Ready to Create a Memorial?</h3>
              <p class="cta-description">
                Join thousands of families who have chosen to honor their loved ones with our
                beautiful digital memorials.
              </p>
              <div class="cta-buttons">
                <a href="#" class="btn-primary" onclick="goToCreateMemorial()">
                  <i class="fas fa-heart"></i>
                  Start Creating
                </a>

                <button class="btn-secondary" data-page="exampleMemorial">
                  <i class="fas fa-eye"></i>
                  View Example
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- About Page -->
    <!-- About Page -->
    <section id="about" class="page-section">
      <!-- About Hero Section -->

      <!-- About Hero Section -->
      <div class="about-hero">
        <div class="about-hero-background">
          <div class="floating-heart-bg heart-1">‚ù§Ô∏è</div>
          <div class="floating-heart-bg heart-2">üíï</div>
          <div class="floating-heart-bg heart-3">üíñ</div>
          <div class="floating-heart-bg heart-4">‚ù§Ô∏è</div>
        </div>
        <div class="about-hero-content">
          <h1 class="about-hero-title animate-fade-in">About Us</h1>
          <p class="about-hero-subtitle animate-fade-in">
            We believe every life deserves to be remembered with dignity and love
          </p>
        </div>
      </div>

      <!-- Our Story Section -->
      <div class="about-story-section">
        <div class="page-container">
          <div class="story-card animate-fade-in">
            <h2 class="story-title">Our Story</h2>
            <div class="story-content">
              <p class="story-text">
                The name <span class="highlight-text">Tayvu</span> represents our vision of
                memorials where we truly see and honor our loved one's humanity.
              </p>
              <p class="story-text">
                Born from the belief that remembrance happens when we pause to witness the full
                lives of those we've lost, Tayvu creates spaces where love and memory can flourish.
              </p>
              <div class="story-divider">
                <i class="fas fa-heart"></i>
              </div>
              <p class="story-text emphasis">
                We created Tayvu because we believe grief is not meant to be carried alone, and
                memories are not meant to fade in isolation.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Values Section -->
      <div class="about-values-section">
        <div class="page-container">
          <div class="values-grid">
            <div class="value-card animate-fade-in">
              <div class="value-icon-wrapper">
                <i class="fas fa-hands-holding-heart"></i>
              </div>
              <h3>Compassion</h3>
              <p>Every feature is designed with empathy for those experiencing loss</p>
            </div>
            <div class="value-card animate-fade-in">
              <div class="value-icon-wrapper">
                <i class="fas fa-infinity"></i>
              </div>
              <h3>Eternal Memory</h3>
              <p>Your loved one's story lives on forever in our digital sanctuary</p>
            </div>
            <div class="value-card animate-fade-in">
              <div class="value-icon-wrapper">
                <i class="fas fa-users"></i>
              </div>
              <h3>Community</h3>
              <p>Connect with others who understand and share in remembrance</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Our Promise Section -->
      <div class="about-promise-section">
        <div class="page-container">
          <div class="promise-container animate-fade-in">
            <div class="promise-content">
              <h2 class="promise-title">Our Promise</h2>
              <p class="promise-text">
                Through thoughtful implementation, Tayvu has transformed into a meaningful symbol of
                how we preserve and share what matters most.
              </p>
              <p class="promise-text">
                Whether you're planning ahead, facing sudden loss, or seeking a meaningful way to
                honor someone special, we're here to support you.
              </p>

              <div class="promise-features">
                <div class="promise-feature">
                  <i class="fas fa-check-circle"></i>
                  <span>Your memories are safe forever</span>
                </div>
                <div class="promise-feature">
                  <i class="fas fa-check-circle"></i>
                  <span>No ads, ever - just pure remembrance</span>
                </div>
                <div class="promise-feature">
                  <i class="fas fa-check-circle"></i>
                  <span>Complete privacy control</span>
                </div>
                <div class="promise-feature">
                  <i class="fas fa-check-circle"></i>
                  <span>24/7 compassionate support</span>
                </div>
              </div>
            </div>
            <div class="promise-image">
              <img
                src="https://images.unsplash.com/photo-1609234656388-0ff363383899?w=600&h=400&fit=crop"
                alt="Peaceful memorial garden with flowers"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- CTA Section -->
      <div class="about-cta-section">
        <div class="page-container">
          <div class="about-cta-container animate-fade-in">
            <h2>Ready to Create a Beautiful Memorial?</h2>
            <p>Honor your loved one with a digital tribute that truly captures their spirit</p>
            <div class="about-cta-buttons">
              <button class="btn-primary" onclick="goToCreateMemorial()">
                <i class="fas fa-heart"></i>
                Create Memorial
              </button>
              <button class="btn-secondary" data-page="pricing">
                <i class="fas fa-tag"></i>
                View Pricing
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Pricing Page -->
    <section id="pricing" class="page-section">
      <div class="page-container">
        <div class="section-header animate-fade-in">
          <h1>Simple, Transparent Pricing</h1>
          <p>Choose the plan that best honors your loved one's memory</p>
        </div>

        <div class="pricing-cards">
          <div class="pricing-card animate-fade-in">
            <h3 class="pricing-title">Basic Memorial</h3>
            <div class="pricing-price">$99<span>.99</span></div>
            <p class="pricing-description">Essential features for a beautiful tribute</p>
            <ul class="pricing-features">
              <li><i class="fas fa-check"></i> Hosted forever, no renewal fees</li>
              <li><i class="fas fa-check"></i> No advertisements on memorials, ever</li>
              <li><i class="fas fa-check"></i> Basic privacy controls (public/private)</li>
              <li><i class="fas fa-check"></i> Up to 10 photos</li>
              <li><i class="fas fa-check"></i> Guest book for messages</li>
              <li><i class="fas fa-check"></i> Share via link</li>
              <li><i class="fas fa-check"></i> Mobile friendly</li>
              <li><i class="fas fa-check"></i> Professional, dignified design</li>
            </ul>
            <button class="pricing-cta" onclick="selectPlan('basic')">Create Basic Memorial</button>
          </div>

          <div class="pricing-card featured animate-fade-in">
            <div class="pricing-badge">Most Popular</div>
            <h3 class="pricing-title">Full Featured Memorial</h3>
            <div class="pricing-price">$149<span>.99</span></div>
            <p class="pricing-description">Everything you need for a complete tribute</p>
            <ul class="pricing-features">
              <li><i class="fas fa-check"></i> Everything in Basic</li>
              <li><i class="fas fa-check"></i> Up to 100 Photo Uploads</li>
              <li><i class="fas fa-check"></i> Video Uploads</li>
              <li><i class="fas fa-check"></i> Integrated Donation Collection</li>
              <li><i class="fas fa-check"></i> Multiple memorial administrators</li>
              <li><i class="fas fa-check"></i> Guest book includes messages and images</li>
              <li><i class="fas fa-check"></i> Privacy controls</li>
              <li><i class="fas fa-check"></i> Priority support</li>
            </ul>
            <button class="pricing-cta" onclick="selectPlan('full')">Create Full Memorial</button>
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ Page -->
    <section id="faq" class="page-section">
      <div class="page-container">
        <div class="section-header animate-fade-in">
          <h1>Frequently Asked Questions</h1>
          <p>Everything you need to know about creating and managing digital memorials</p>
        </div>

        <div class="faq-container">
          <div class="faq-category">
            <h2 class="faq-category-title">
              <i class="fas fa-info-circle"></i>
              General Questions
            </h2>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>What is Tayvu?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p>
                  Tayvu is a compassionate digital platform that allows families to create
                  beautiful, lasting online memorials for their loved ones. Our service goes beyond
                  traditional obituaries by providing interactive features like photo galleries,
                  timelines, guest books, and the ability for friends and family to share memories
                  and tributes.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>How long will the memorial stay online?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p>
                  Your memorial will remain online forever. We are committed to preserving memories
                  for generations to come. Unlike other services that may remove content after a
                  certain period, we guarantee that your loved one's memorial will always be
                  accessible to family and friends.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>Can I create a memorial for someone who passed away years ago?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p>
                  Absolutely! There's no time limit on when you can create a memorial. Many families
                  create memorials years after their loved one's passing as a way to preserve
                  memories and share stories with younger generations who may not have had the
                  chance to meet them.
                </p>
              </div>
            </div>
          </div>

          <div class="faq-category">
            <h2 class="faq-category-title">
              <i class="fas fa-cog"></i>
              Creating & Managing Memorials
            </h2>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>How do I create a memorial?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p>Creating a memorial is simple:</p>
                <ol>
                  <li>Sign up for an account or sign in</li>
                  <li>Click "Create Memorial" and choose your plan</li>
                  <li>Fill in basic information about your loved one</li>
                  <li>Upload photos and add stories</li>
                  <li>Customize the memorial with timeline events and other features</li>
                  <li>Share the memorial link with family and friends</li>
                </ol>
                <p>
                  Our intuitive interface guides you through each step, and you can save your
                  progress and return anytime.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>Can multiple people manage a memorial?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p>
                  Yes! You can invite family members to be co-administrators of the memorial. This
                  allows multiple people to add photos, update information, and manage guest book
                  entries. It's a great way to share the responsibility and ensure the memorial
                  includes memories from different family members.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>What types of content can I add to a memorial?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p>You can add a variety of content to make the memorial unique and personal:</p>
                <ul>
                  <li><strong>Photos:</strong> Unlimited high-resolution images</li>
                  <li><strong>Videos:</strong> Share video memories and tributes</li>
                  <li><strong>Life Story:</strong> Write a detailed biography or obituary</li>
                  <li>
                    <strong>Timeline:</strong> Create a chronological journey of important life
                    events
                  </li>
                  <li><strong>Music:</strong> Add favorite songs or background music</li>
                  <li>
                    <strong>Documents:</strong> Upload certificates, awards, or other meaningful
                    documents
                  </li>
                  <li>
                    <strong>Guest Book:</strong> Allow visitors to leave messages and memories
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="faq-category">
            <h2 class="faq-category-title">
              <i class="fas fa-shield-alt"></i>
              Privacy & Security
            </h2>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>Can I control who sees the memorial?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p>Yes, you have complete control over memorial privacy. You can choose from:</p>
                <ul>
                  <li><strong>Public:</strong> Anyone can find and view the memorial</li>
                  <li><strong>Unlisted:</strong> Only people with the direct link can access it</li>
                  <li>
                    <strong>Private:</strong> Password-protected, only invited guests can view
                  </li>
                </ul>
                <p>You can also control whether visitors can leave messages.</p>
              </div>
            </div>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>Is my data secure?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p>Absolutely. We use enterprise-grade security measures including:</p>
                <ul>
                  <li>SSL encryption for all data transmission</li>
                  <li>Secure cloud storage with regular backups</li>
                  <li>GDPR-compliant data handling</li>
                  <li>Regular security audits and updates</li>
                </ul>
                <p>
                  Your memories and personal information are protected with the highest standards of
                  digital security.
                </p>
              </div>
            </div>
          </div>

          <div class="faq-category">
            <h2 class="faq-category-title">
              <i class="fas fa-dollar-sign"></i>
              Pricing & Payment
            </h2>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>What's included in each plan?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p><strong>Basic Memorial ($49.99):</strong></p>
                <ul>
                  <li>Beautiful memorial page</li>
                  <li>Up to 50 photos</li>
                  <li>Life story section</li>
                  <li>Guest book for messages</li>
                  <li>Share via link</li>
                  <li>Mobile friendly</li>
                </ul>
                <p><strong>Full Featured Memorial ($99.99):</strong></p>
                <ul>
                  <li>Everything in Basic, plus:</li>
                  <li>Unlimited photos & videos</li>
                  <li>Timeline of life events</li>
                  <li>Music & audio memories</li>
                  <li>Virtual candle lighting</li>
                  <li>Donation collection</li>
                  <li>Privacy controls</li>
                  <li>Download memorial book</li>
                  <li>Priority support</li>
                </ul>
              </div>
            </div>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>Are there any recurring fees?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p>
                  No! Both our Basic and Full Featured plans are one-time payments. There are no
                  monthly or annual fees. Once you create a memorial, it stays online forever at no
                  additional cost.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>Can I upgrade my plan later?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p>
                  Yes, you can upgrade from Basic to Full Featured at any time. You'll only pay the
                  difference between the two plans. All your existing content will be preserved, and
                  you'll immediately get access to all the additional features.
                </p>
              </div>
            </div>
          </div>

          <div class="faq-category">
            <h2 class="faq-category-title">
              <i class="fas fa-life-ring"></i>
              Support & Help
            </h2>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>What if I need help creating a memorial?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p>We're here to help! Our support team is available 24/7 to assist you:</p>
                <ul>
                  <li>Email: support@tayvu.com</li>
                </ul>
                <p>
                  We also offer step-by-step tutorials and can even help you set up the memorial
                  over the phone if needed.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <button class="faq-question" data-faq-toggle>
                <span>Can I transfer a memorial from another service?</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="faq-answer">
                <p>
                  Yes! We offer free migration assistance from other memorial websites. Our team can
                  help you transfer photos, text, and other content from your existing memorial.
                  Contact our support team, and we'll guide you through the process.
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="faq-cta">
          <h3>Still have questions?</h3>
          <p>
            Our compassionate support team is here to help you create a beautiful memorial for your
            loved one.
          </p>
          <div class="faq-cta-buttons">
            <a href="mailto:support@tayvu.com" class="btn-primary">
              <i class="fas fa-envelope"></i>
              <span>Email Support</span>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Profile Page -->
    <section id="profile" class="page-section">
      <div class="profile-page-container">
        <!-- Profile Header -->

        <div class="profile-header-section">
          <div class="profile-cover-photo"></div>
          <div class="profile-header-content">
            <div class="profile-photo-container">
              <img
                src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=150&h=150&fit=crop"
                alt="Profile"
                class="profile-photo-large"
                id="profilePhotoLarge"
              />
              <button class="profile-photo-edit" onclick="uploadProfilePhoto()">
                <i class="fas fa-camera"></i>
              </button>
            </div>
            <div class="profile-info">
              <h1 class="profile-name" id="profileName">Loading...</h1>
              <p class="profile-email" id="profileEmail">Loading...</p>
            </div>
          </div>
        </div>

        <div class="profile-stats">
          <div class="profile-stat">
            <span class="stat-value" id="memorialsCount">0</span>
            <span class="stat-label">Memorials</span>
          </div>
          <div class="profile-stat">
            <span class="stat-value" id="contributionsCount">0</span>
            <span class="stat-label">Contributions</span>
          </div>
          <div class="profile-stat">
            <span class="stat-value" id="visitorsCount">0</span>
            <span class="stat-label">Visitors</span>
          </div>
        </div>

        <!-- Profile Content Tabs -->
        <div class="profile-content">
          <div class="profile-tabs">
            <button class="profile-tab active" onclick="switchProfileTab('memorials')">
              <i class="fas fa-monument"></i>
              My Memorials
            </button>
            <button class="profile-tab" onclick="switchProfileTab('contributions')">
              <i class="fas fa-heart"></i>
              My Contributions
            </button>
            <button class="profile-tab" onclick="switchProfileTab('settings')">
              <i class="fas fa-cog"></i>
              Settings
            </button>
          </div>

          <!-- Memorials Tab -->
          <div class="profile-tab-content active" id="memorialsTab">
            <div class="tab-header">
              <h2 class="section-title">My Memorials</h2>
              <button class="btn-primary" onclick="goToCreateMemorial()">
                <i class="fas fa-plus"></i>
                Create New Memorial
              </button>
            </div>

            <div class="memorials-grid" id="myMemorials">
              <!-- Memorial cards will be populated here -->

              <div class="empty-state">
                <div class="empty-state-icon">
                  <i class="fas fa-monument"></i>
                </div>
                <h3>No memorials yet</h3>
                <p>Create your first memorial to honor a loved one</p>
                <button class="btn-primary" onclick="goToCreateMemorial()">
                  <i class="fas fa-plus"></i>
                  Create Memorial
                </button>
              </div>
            </div>
          </div>

          <!-- Contributions Tab -->
          <div class="profile-tab-content" id="contributionsTab">
            <div class="tab-header">
              <h2 class="section-title">My Contributions</h2>
              <!-- ADD class="section-title" -->
            </div>
            <div class="contributions-list" id="myContributions">
              <!-- Contributions will be populated here -->

              <div class="empty-state">
                <div class="empty-state-icon">
                  <i class="fas fa-heart"></i>
                </div>
                <h3>No contributions yet</h3>
                <p>Visit memorials to leave messages and light candles</p>
              </div>
            </div>
          </div>

          <!-- Settings Tab -->
          <div class="profile-tab-content" id="settingsTab">
            <div class="tab-header">
              <h2 class="section-title">Account Settings</h2>
              <!-- ADD class="section-title" -->
            </div>
            <div class="settings-container">
              <div class="settings-section">
                <h3>Profile Information</h3>
                <form id="profileSettingsForm" onsubmit="updateProfile(event)">
                  <div class="form-group">
                    <label for="settingsName">Display Name</label>
                    <input type="text" id="settingsName" name="name" required />
                  </div>
                  <div class="form-group">
                    <label for="settingsEmail">Email</label>
                    <input type="email" id="settingsEmail" name="email" disabled />
                    <small>Email cannot be changed</small>
                  </div>

                  <button type="submit" class="btn-primary">
                    <i class="fas fa-save"></i>
                    Save Changes
                  </button>
                </form>
              </div>

              <div class="settings-section danger-zone">
                <h3>Danger Zone</h3>
                <p>Once you delete your account, there is no going back. Please be certain.</p>
                <button class="btn-danger" onclick="confirmDeleteAccount()">
                  <i class="fas fa-trash"></i>
                  Delete Account
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Create Memorial Page -->
    <section id="createMemorial" class="page-section create-memorial-page">
      <div class="create-memorial-container">
        <!-- Header -->
        <div class="create-memorial-header">
          <button class="back-button" data-action="profile">
            <i class="fas fa-arrow-left"></i>
            Back to Profile
          </button>
          <h1>Create Memorial</h1>
          <button class="save-draft-btn" onclick="saveDraft()">
            <i class="fas fa-save"></i>
            Save Draft
          </button>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-steps">
            <div class="progress-step active" data-step="1">
              <div class="step-circle">1</div>
              <span>Basic Info</span>
            </div>
            <div class="progress-step" data-step="2">
              <div class="step-circle">2</div>
              <span>Obituary</span>
            </div>
            <div class="progress-step" data-step="3">
              <div class="step-circle">3</div>
              <span>Service Info</span>
            </div>

            <div class="progress-step" data-step="4">
              <div class="step-circle">5</div>
              <span>Moments</span>
            </div>
            <div class="progress-step" data-step="5">
              <div class="step-circle">6</div>
              <span>Preview</span>
            </div>
          </div>
        </div>

        <!-- Form Container -->
        <div class="create-memorial-form">
          <!-- Step 1: Basic Information -->
          <div class="form-step active" id="step1">
            <h2 class="step-title">Basic Information</h2>
            <p class="step-subtitle">Let's start with the essential details</p>

            <div class="form-section">
              <h3>Personal Details</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label for="firstName">First Name *</label>
                  <input
                    type="text"
                    id="firstName"
                    name="firstName"
                    required
                    placeholder="Enter first name"
                  />
                </div>

                <!-- ADD THIS NEW MIDDLE NAME FIELD HERE -->
                <div class="form-group">
                  <label for="middleName">Middle Name</label>
                  <input
                    type="text"
                    id="middleName"
                    name="middleName"
                    placeholder="Enter middle name (optional)"
                  />
                </div>

                <div class="form-group">
                  <label for="lastName">Last Name *</label>
                  <input
                    type="text"
                    id="lastName"
                    name="lastName"
                    required
                    placeholder="Enter last name"
                  />
                </div>
                <div class="form-group">
                  <label for="birthDate">Date of Birth *</label>
                  <input
                    type="date"
                    id="birthDate"
                    name="birthDate"
                    required
                    min="1850-01-01"
                    max=""
                    onchange="validateDates()"
                    oninput="validateDates()"
                  />
                  <small id="birthDateError" style="color: #e53e3e; display: none"></small>
                </div>
                <div class="form-group">
                  <label for="deathDate">Date of Passing *</label>
                  <input
                    type="date"
                    id="deathDate"
                    name="deathDate"
                    required
                    min="1850-01-01"
                    max=""
                    onchange="validateDates()"
                    oninput="validateDates()"
                  />
                  <small id="deathDateError" style="color: #e53e3e; display: none"></small>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3>Memorial Images</h3>
              <div class="image-upload-grid">
                <div class="image-upload-box">
                  <label>Profile Photo *</label>
                  <div class="upload-area" id="profilePhotoUpload" onclick="uploadImage('profile')">
                    <img id="profilePhotoPreview" style="display: none" />
                    <div class="upload-placeholder">
                      <i class="fas fa-camera"></i>
                      <p>Click to upload profile photo</p>
                      <small>Recommended: Square image, min 400x400px</small>
                    </div>
                  </div>
                </div>

                <div class="image-upload-box">
                  <label>Background Image (Optional)</label>
                  <div
                    class="upload-area"
                    id="backgroundPhotoUpload"
                    onclick="uploadImage('background')"
                  >
                    <img id="backgroundPhotoPreview" style="display: none" />
                    <div class="upload-placeholder">
                      <i class="fas fa-image"></i>
                      <p>Click to upload background image</p>
                      <small>Recommended: 1600x600px</small>
                    </div>
                  </div>

                  <!-- ADD THIS NEW SECTION FOR DEFAULT IMAGES -->
                  <div style="margin-top: 1rem">
                    <p style="text-align: center; color: #64748b; margin-bottom: 1rem">
                      Or choose from our collection:
                    </p>
                    <div class="default-backgrounds-grid">
                      <div
                        class="default-bg-option"
                        onclick="selectDefaultBackground('https://images.unsplash.com/photo-1516589091380-5d8e87df6999?w=1600&h=600&fit=crop')"
                        title="Sunset Sky"
                      >
                        <img
                          src="https://images.unsplash.com/photo-1516589091380-5d8e87df6999?w=200&h=75&fit=crop"
                          alt="Sunset Sky"
                        />
                        <span>Sunset Sky</span>
                      </div>
                      <div
                        class="default-bg-option"
                        onclick="selectDefaultBackground('https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=1600&h=600&fit=crop')"
                        title="Peaceful Field"
                      >
                        <img
                          src="https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=200&h=75&fit=crop"
                          alt="Peaceful Field"
                        />
                        <span>Peaceful Field</span>
                      </div>
                      <div
                        class="default-bg-option"
                        onclick="selectDefaultBackground('https://images.unsplash.com/photo-1505144808419-1957a94ca61e?w=1600&h=600&fit=crop')"
                        title="Ocean Waves"
                      >
                        <img
                          src="https://images.unsplash.com/photo-1505144808419-1957a94ca61e?w=200&h=75&fit=crop"
                          alt="Ocean Waves"
                        />
                        <span>Ocean Waves</span>
                      </div>
                      <div
                        class="default-bg-option"
                        onclick="selectDefaultBackground('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1600&h=600&fit=crop')"
                        title="Beach Sunset"
                      >
                        <img
                          src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=200&h=75&fit=crop"
                          alt="Beach Sunset"
                        />
                        <span>Beach Sunset</span>
                      </div>
                      <div
                        class="default-bg-option"
                        onclick="selectDefaultBackground('https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1600&h=600&fit=crop')"
                        title="Forest Path"
                      >
                        <img
                          src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=200&h=75&fit=crop"
                          alt="Forest Path"
                        />
                        <span>Forest Path</span>
                      </div>
                      <div
                        class="default-bg-option"
                        onclick="selectDefaultBackground('https://images.unsplash.com/photo-1518173946687-a4c8892bbd9f?w=1600&h=600&fit=crop')"
                        title="Mountain Lake"
                      >
                        <img
                          src="https://images.unsplash.com/photo-1518173946687-a4c8892bbd9f?w=200&h=75&fit=crop"
                          alt="Mountain Lake"
                        />
                        <span>Mountain Lake</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3>Memorial Headline</h3>
              <div class="form-group">
                <label for="headline">Headline *</label>
                <input
                  type="text"
                  id="headline"
                  name="headline"
                  required
                  placeholder="e.g., 'Celebrating a Life of Love and Compassion'"
                />
                <small>A meaningful phrase that captures their essence</small>
                <div
                  style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px"
                >
                  <small
                    style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #64748b"
                    >Need inspiration? Consider these examples:</small
                  >
                  <ul
                    style="
                      margin: 0;
                      padding-left: 1.5rem;
                      color: #64748b;
                      font-size: 0.875rem;
                      line-height: 1.6;
                    "
                  >
                    <li>A Life Devoted to Family and Faith</li>
                    <li>Forever in Our Hearts, Always in Our Memories</li>
                    <li>Celebrating a Legacy of Love and Laughter</li>
                    <li>A Beautiful Soul Who Touched Many Lives</li>
                    <li>Remembering a Life of Service and Compassion</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3>Opening Statement</h3>
              <div class="form-group">
                <label for="openingStatement">Opening Statement *</label>
                <textarea
                  id="openingStatement"
                  name="openingStatement"
                  rows="4"
                  required
                  placeholder="Write a heartfelt opening that introduces your loved one..."
                ></textarea>
                <small>A brief, heartfelt introduction that sets the tone for the memorial</small>
                <div
                  style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px"
                >
                  <small
                    style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #64748b"
                    >Example opening statements:</small
                  >
                  <ul
                    style="
                      margin: 0;
                      padding-left: 1.5rem;
                      color: #64748b;
                      font-size: 0.875rem;
                      line-height: 1.8;
                    "
                  >
                    <li style="margin-bottom: 0.5rem">
                      Margaret Rose Thompson, beloved mother, grandmother, and pillar of her
                      community, peacefully passed away on December 3, 2023, at the age of 78,
                      surrounded by her loving family.
                    </li>
                    <li style="margin-bottom: 0.5rem">
                      With heavy hearts, we announce the passing of John Michael Davis, devoted
                      husband, father, and friend to many, who left us on January 15, 2024, after a
                      courageous battle with cancer.
                    </li>
                    <li style="margin-bottom: 0.5rem">
                      It is with profound sadness that we share the news of Sarah Elizabeth Wilson's
                      passing on February 20, 2024. A beacon of light and joy to all who knew her,
                      Sarah lived a life full of adventure, laughter, and unconditional love.
                    </li>
                    <li>
                      Robert James Anderson, cherished father, grandfather, and respected community
                      leader, completed his earthly journey on March 10, 2024, leaving behind a
                      legacy of kindness, integrity, and service to others.
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" data-action="profile">Cancel</button>
              <button type="button" class="btn-primary" onclick="nextStep()">
                Next: Obituary Details
                <i class="fas fa-arrow-right"></i>
              </button>
            </div>
            <!-- This closes form-actions -->
          </div>
          <!-- This closes Step 1 -->

          <!-- Step 2: Life Story -->
          <div class="form-step" id="step2">
            <h2 class="step-title">Obituary Details</h2>
            <p class="step-subtitle">Write the full obituary to honor and celebrate their life</p>
            <div class="form-section">
              <div class="form-group">
                <label for="lifeStory">Full Obituary</label>
                <div
                  id="lifeStory"
                  class="rich-text-editor"
                  contenteditable="true"
                  placeholder="Write the complete obituary here. Include their life story, accomplishments, family, passions, and legacy..."
                ></div>
                <small
                  >This is where you can write the complete obituary. Include details about their
                  childhood, education, career, family life, hobbies, achievements, and the legacy
                  they leave behind. Take your time to create a meaningful tribute.</small
                >
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" onclick="previousStep()">
                <i class="fas fa-arrow-left"></i>
                Previous
              </button>
              <button type="button" class="btn-primary" onclick="nextStep()">
                Next: Service Information
                <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </div>

          <!-- Step 3: Service Information -->
          <div class="form-step" id="step3">
            <h2 class="step-title">Service Information</h2>
            <p class="step-subtitle">Add details about memorial services (optional)</p>

            <div class="service-items" id="serviceItems">
              <div class="service-item-form">
                <h3>Service 1</h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label>Service Type</label>
                    <select name="serviceType">
                      <option value="">Select type...</option>
                      <option value="viewing">Viewing & Visitation</option>
                      <option value="funeral">Funeral Service</option>
                      <option value="memorial">Memorial Service</option>
                      <option value="celebration">Celebration of Life</option>
                      <option value="reception">Reception</option>
                      <option value="burial">Burial</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Date</label>
                    <input type="date" name="serviceDate" />
                  </div>
                  <div class="form-group">
                    <label>Time</label>
                    <input type="time" name="serviceTime" />
                  </div>
                  <div class="form-group">
                    <label>Location Name</label>
                    <input type="text" name="locationName" placeholder="e.g., St. Mary's Church" />
                  </div>
                  <div class="form-group full-width">
                    <label>Address</label>
                    <input type="text" name="locationAddress" placeholder="Full address" />
                  </div>
                </div>
              </div>
            </div>

            <button type="button" class="btn-add" onclick="addServiceItem()">
              <i class="fas fa-plus"></i>
              Add Another Service
            </button>

            <div class="form-section">
              <div class="form-group">
                <label for="serviceNote">Additional Information (Optional)</label>
                <textarea
                  id="serviceNote"
                  rows="2"
                  placeholder="e.g., 'The family warmly invites you to join them for refreshments...'"
                ></textarea>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" onclick="previousStep()">
                <i class="fas fa-arrow-left"></i>
                Previous
              </button>
              <button type="button" class="btn-ghost" onclick="skipStep()">Skip This Step</button>
              <button type="button" class="btn-primary" onclick="nextStep()">
                Next: Cherished Moments
                <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </div>

          <!-- Step 4: Cherished Moments -->
          <div class="form-step" id="step4">
            <h2 class="step-title">Cherished Moments</h2>
            <p class="step-subtitle">Upload photos and videos to celebrate special memories</p>

            <!-- Upload Section -->
            <div class="moments-upload-section">
              <div
                class="upload-zone-compact"
                id="momentsDropZone"
                ondrop="handleDrop(event)"
                ondragover="handleDragOver(event)"
                ondragleave="handleDragLeave(event)"
              >
                <i class="fas fa-cloud-upload-alt"></i>
                <div class="upload-text">
                  <h4>Drag & drop photos or videos here</h4>
                  <p>or</p>
                  <button type="button" class="btn-upload" onclick="selectMoments()">
                    <i class="fas fa-folder-open"></i>
                    Browse Files
                  </button>
                  <small>Supports: JPG, PNG, GIF, MP4, MOV (Max 50MB per file)</small>
                </div>
              </div>

              <div class="upload-stats">
                <div class="stat-item">
                  <i class="fas fa-images"></i>
                  <span><strong id="photoCount">0</strong> Photos</span>
                </div>
                <div class="stat-item">
                  <i class="fas fa-video"></i>
                  <span><strong id="videoCount">0</strong> Videos</span>
                </div>
              </div>
            </div>

            <!-- Preview Section -->
            <div class="moments-preview-section">
              <div class="preview-header">
                <h3>Preview Your Gallery</h3>
                <div class="view-options">
                  <button type="button" class="view-btn active" onclick="changeGridView('grid')">
                    <i class="fas fa-th"></i>
                  </button>
                  <button type="button" class="view-btn" onclick="changeGridView('list')">
                    <i class="fas fa-list"></i>
                  </button>
                </div>
              </div>

              <div class="moments-preview-grid" id="momentsPreviewGrid">
                <!-- Empty state -->
                <div class="moments-empty-state" id="momentsEmptyState">
                  <i class="fas fa-camera-retro"></i>
                  <h4>No moments uploaded yet</h4>
                  <p>Upload photos and videos to see them here</p>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" onclick="previousStep()">
                <i class="fas fa-arrow-left"></i>
                Previous
              </button>
              <button type="button" class="btn-ghost" onclick="skipStep()">Skip This Step</button>
              <button type="button" class="btn-primary" onclick="nextStep()">
                Preview Memorial
                <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </div>

          <!-- Step 6: Preview -->
          <div class="form-step" id="step5">
            <h2 class="step-title">Preview Your Memorial</h2>
            <p class="step-subtitle">Review how the memorial will look before publishing</p>

            <div class="preview-container">
              <div class="preview-device">
                <div class="device-frame">
                  <iframe id="memorialPreview" src="#"></iframe>
                </div>
              </div>

              <div class="preview-actions">
                <button type="button" class="btn-ghost" onclick="previewDevice('desktop')">
                  <i class="fas fa-desktop"></i>
                  Desktop
                </button>
                <button type="button" class="btn-ghost" onclick="previewDevice('tablet')">
                  <i class="fas fa-tablet-alt"></i>
                  Tablet
                </button>
                <button type="button" class="btn-ghost" onclick="previewDevice('mobile')">
                  <i class="fas fa-mobile-alt"></i>
                  Mobile
                </button>
              </div>
            </div>

            <div class="form-section">
              <h3>Privacy Settings</h3>
              <div class="privacy-options">
                <label class="radio-option">
                  <input type="radio" name="privacy" value="public" checked />
                  <div class="radio-content">
                    <strong>Public</strong>
                    <small>Anyone can find and view this memorial</small>
                  </div>
                </label>
                <label class="radio-option">
                  <input type="radio" name="privacy" value="unlisted" />
                  <div class="radio-content">
                    <strong>Unlisted</strong>
                    <small>Only people with the link can view</small>
                  </div>
                </label>
                <label class="radio-option">
                  <input type="radio" name="privacy" value="private" />
                  <div class="radio-content">
                    <strong>Private</strong>
                    <small>Password protected - invite only</small>
                  </div>
                </label>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" onclick="previousStep()">
                <i class="fas fa-arrow-left"></i>
                Back to Edit
              </button>
              <button type="button" class="btn-primary btn-publish" onclick="publishMemorial()">
                <i class="fas fa-globe"></i>
                Publish Memorial
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Example Memorial Page -->
    <section id="exampleMemorial" class="page-section memorial-page">
      <div class="memorial-hero">
        <div class="memorial-hero-overlay"></div>
        <div class="memorial-hero-content">
          <img
            src="https://images.unsplash.com/photo-1566616213894-2d4e1baee5d8?w=200&h=200&fit=crop"
            alt="Margaret Rose Thompson"
            class="memorial-main-photo"
          />
          <h1 class="memorial-main-name">Margaret Rose Thompson</h1>
          <p class="memorial-main-dates">March 15, 1945 - December 3, 2023</p>

          <div class="memorial-hero-actions">
            <button class="memorial-hero-btn" onclick="shareMemorial()">
              <i class="fas fa-share"></i>
              Share Memorial
            </button>
          </div>
        </div>
      </div>

      <div class="memorial-body">
        <!-- Obituary Section -->
        <section class="obituary-section">
          <div class="obituary-container">
            <h2 class="obituary-title">Celebrating a Life of Love and Compassion</h2>
            <div class="obituary-content">
              <p class="obituary-lead serif-text">
                Margaret Rose Thompson, beloved mother, grandmother, and pillar of her community,
                peacefully passed away on December 3, 2023, at the age of 78, surrounded by her
                loving family.
              </p>
              <div class="obituary-details">
                <p>
                  Born in Springfield, Illinois, Margaret was the eldest of five children. She
                  graduated from Northwestern University with a degree in Education and dedicated 35
                  years to teaching elementary school, touching the lives of thousands of students
                  who still remember her warmth and encouragement.
                </p>
                <p>
                  Margaret married her college sweetheart, Robert Thompson, in 1968, and together
                  they raised three wonderful children: Sarah, Michael, and Emily. Her greatest joy
                  came from her seven grandchildren, who lovingly called her "Nana Rose."
                </p>
                <p>
                  An avid gardener and community volunteer, Margaret transformed countless lives
                  through her work with the local food bank and literacy programs. Her garden was
                  legendary in the neighborhood, and she never missed an opportunity to share both
                  her flowers and her wisdom with others.
                </p>
                <p>
                  Margaret is survived by her husband of 55 years, Robert; her three children and
                  their spouses; seven grandchildren; and countless friends whose lives she
                  enriched. She was preceded in death by her parents and two siblings.
                </p>
              </div>
            </div>
          </div>
        </section>

        <!-- Service Information Section -->
        <section class="service-section">
          <div class="service-container">
            <div class="service-header">
              <h2>Join Us in Celebrating Margaret's Life</h2>
              <p>All are welcome to attend and share in remembering a life well-lived</p>
            </div>

            <div class="service-info">
              <div class="service-item">
                <div class="service-item-header">
                  <h3 class="service-item-title">Viewing & Visitation</h3>
                </div>
                <div class="service-details">
                  <div class="service-detail-row">
                    <i class="fas fa-calendar"></i>
                    <span>December 7, 2023</span>
                  </div>
                  <div class="service-detail-row">
                    <i class="fas fa-clock"></i>
                    <span>4:00 PM - 8:00 PM</span>
                  </div>
                  <div class="service-detail-row">
                    <i class="fas fa-location-dot"></i>
                    <div>
                      <span class="service-location-name">Thompson Funeral Home</span>
                      <span class="service-address"
                        >1234 Oak Street<br />Springfield, IL 62701</span
                      >
                    </div>
                  </div>
                </div>
              </div>

              <div class="service-item">
                <div class="service-item-header">
                  <h3 class="service-item-title">Celebration of Life Service</h3>
                </div>
                <div class="service-details">
                  <div class="service-detail-row">
                    <i class="fas fa-calendar"></i>
                    <span>December 8, 2023</span>
                  </div>
                  <div class="service-detail-row">
                    <i class="fas fa-clock"></i>
                    <span>11:00 AM</span>
                  </div>
                  <div class="service-detail-row">
                    <i class="fas fa-location-dot"></i>
                    <div>
                      <span class="service-location-name">St. Mary's Church</span>
                      <span class="service-address"
                        >789 Cathedral Avenue<br />Springfield, IL 62702</span
                      >
                    </div>
                  </div>
                </div>
              </div>

              <div class="service-item">
                <div class="service-item-header">
                  <h3 class="service-item-title">Reception & Fellowship</h3>
                </div>
                <div class="service-details">
                  <div class="service-detail-row">
                    <i class="fas fa-clock"></i>
                    <span>1:00 PM - 3:00 PM</span>
                  </div>
                  <div class="service-detail-row">
                    <i class="fas fa-location-dot"></i>
                    <div>
                      <span class="service-location-name">Church Community Hall</span>
                      <span class="service-address">Adjacent to St. Mary's Church</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="service-footer">
              <p>
                In lieu of flowers, donations may be made to the Springfield Literacy Foundation
              </p>
              <p>
                For questions, please contact:
                <a href="mailto:thompsonmemorial@email.com">thompsonmemorial@email.com</a>
              </p>
            </div>
          </div>
        </section>

        <!-- Cherished Moments Section - VSCO Style -->
        <section class="moments-vsco">
          <!-- Minimal Header -->
          <div class="moments-header-minimal">
            <h2 class="moments-title-minimal">Cherished Moments</h2>
            <p class="moments-tagline">A tapestry of love woven through time</p>
          </div>

          <!-- Clean Grid -->
          <div class="moments-grid-vsco">
            <!-- Standard photo -->
            <div class="moment-vsco" data-category="photos">
              <img
                src="https://images.unsplash.com/photo-1530103862676-de8c9debad1d?w=400&h=400&fit=crop"
                alt="75th Birthday"
              />
              <div class="moment-overlay-vsco">
                <div class="moment-date-vsco">March 15, 2020</div>
                <div class="moment-caption-vsco">75th birthday celebration</div>
              </div>
            </div>

            <!-- Wide photo -->
            <div class="moment-vsco wide" data-category="photos milestones">
              <img
                src="https://images.unsplash.com/photo-1534067783941-51c9c23ecefd?w=800&h=400&fit=crop"
                alt="Garden Award"
              />
              <div class="moment-overlay-vsco">
                <div class="moment-date-vsco">May 20, 2021</div>
                <div class="moment-caption-vsco">Garden club award winner - 3 years running</div>
              </div>
              <span class="milestone-indicator">milestone</span>
            </div>

            <!-- Video -->
            <div class="moment-vsco" data-category="videos">
              <img
                src="https://images.unsplash.com/photo-1511285560929-80b456fea0bc?w=400&h=400&fit=crop"
                alt="Wedding Dance"
              />
              <div class="moment-overlay-vsco">
                <div class="moment-date-vsco">June 12, 1968</div>
                <div class="moment-caption-vsco">First dance as newlyweds</div>
              </div>
              <div class="video-indicator">
                <i class="fas fa-play"></i>
              </div>
            </div>

            <!-- Standard photos -->
            <div class="moment-vsco" data-category="photos">
              <img
                src="https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=400&h=400&fit=crop"
                alt="Paris Trip"
              />
              <div class="moment-overlay-vsco">
                <div class="moment-date-vsco">September 8, 2018</div>
                <div class="moment-caption-vsco">Dream trip to Paris</div>
              </div>
            </div>

            <div class="moment-vsco" data-category="photos">
              <img
                src="https://images.unsplash.com/photo-1606787366850-de6330128bfc?w=400&h=400&fit=crop"
                alt="Family BBQ"
              />
              <div class="moment-overlay-vsco">
                <div class="moment-date-vsco">July 4, 2022</div>
                <div class="moment-caption-vsco">Annual family BBQ</div>
              </div>
            </div>

            <!-- Tall photo -->
            <div class="moment-vsco tall" data-category="photos milestones">
              <img
                src="https://images.unsplash.com/photo-1543807535-eceef0bc6599?w=400&h=800&fit=crop"
                alt="Christmas 2022"
              />
              <div class="moment-overlay-vsco">
                <div class="moment-date-vsco">December 25, 2022</div>
                <div class="moment-caption-vsco">Last Christmas together</div>
              </div>
              <span class="milestone-indicator">milestone</span>
            </div>

            <!-- More standard photos -->
            <div class="moment-vsco" data-category="photos">
              <img
                src="https://images.unsplash.com/photo-1516589091380-5d8e87df6999?w=400&h=400&fit=crop"
                alt="Memory"
              />
              <div class="moment-overlay-vsco">
                <div class="moment-date-vsco">August 3, 2019</div>
                <div class="moment-caption-vsco">Summer garden party</div>
              </div>
            </div>

            <div class="moment-vsco" data-category="videos milestones">
              <img
                src="https://images.unsplash.com/photo-1511285560929-80b456fea0bc?w=400&h=400&fit=crop"
                alt="50th Anniversary"
              />
              <div class="moment-overlay-vsco">
                <div class="moment-date-vsco">June 12, 2018</div>
                <div class="moment-caption-vsco">50th anniversary toast</div>
              </div>
              <div class="video-indicator">
                <i class="fas fa-play"></i>
              </div>
              <span class="milestone-indicator">golden</span>
            </div>

            <div class="moment-vsco" data-category="photos">
              <img
                src="https://images.unsplash.com/photo-1523438097201-512ae7d59c44?w=400&h=400&fit=crop"
                alt="Memory"
              />
              <div class="moment-overlay-vsco">
                <div class="moment-date-vsco">October 15, 2021</div>
                <div class="moment-caption-vsco">Autumn walk in the park</div>
              </div>
            </div>
          </div>

          <!-- Load More -->
          <div class="load-more-vsco">
            <button class="load-more-btn" onclick="loadMoreMemories()">load more memories</button>
          </div>
        </section>

        <!-- Floating Add Button for Memories -->
        <button class="add-memory-fab" onclick="uploadMemory()">
          <i class="fas fa-plus"></i>
        </button>

        <!-- Guest Book Section -->
        <section class="guestbook-section">
          <div class="guestbook-container">
            <h2 class="section-title">Messages of Love</h2>
            <div class="guestbook-header">
              <p class="guestbook-intro">
                Share your memories and messages for the Thompson family
              </p>
              <button class="btn-primary" onclick="openGuestbookModal()">
                <i class="fas fa-pen"></i>
                Leave a Message
              </button>
            </div>

            <div class="guestbook-entries">
              <div class="guestbook-entry">
                <div class="entry-header">
                  <img
                    src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=50&h=50&fit=crop"
                    alt="Sarah Johnson"
                  />
                  <div class="entry-info">
                    <h4>Sarah Johnson</h4>
                    <p class="entry-date">December 5, 2023</p>
                  </div>
                </div>
                <p class="entry-message">
                  Grandma, you were the heart of our family. Your wisdom, kindness, and famous apple
                  pie will be missed but never forgotten. Thank you for teaching me that love is the
                  greatest gift we can give. Until we meet again...
                </p>
                <div class="entry-actions">
                  <button class="action-btn"><i class="fas fa-heart"></i> 24</button>
                </div>
              </div>

              <div class="guestbook-entry">
                <div class="entry-header">
                  <img
                    src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=50&h=50&fit=crop"
                    alt="Michael Chen"
                  />
                  <div class="entry-info">
                    <h4>Michael Chen</h4>
                    <p class="entry-date">December 4, 2023</p>
                  </div>
                </div>
                <p class="entry-message">
                  Mrs. Thompson was my third-grade teacher and changed my life. She saw potential in
                  a shy kid and encouraged me to pursue my dreams. I became a teacher because of
                  her. Her legacy lives on in every student she touched.
                </p>
                <div class="entry-actions">
                  <button class="action-btn"><i class="fas fa-heart"></i> 18</button>
                </div>
              </div>

              <div class="guestbook-entry">
                <div class="entry-header">
                  <img
                    src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=50&h=50&fit=crop"
                    alt="Emily Williams"
                  />
                  <div class="entry-info">
                    <h4>Emily Williams</h4>
                    <p class="entry-date">December 4, 2023</p>
                  </div>
                </div>
                <p class="entry-message">
                  Margaret's garden was a sanctuary for our entire neighborhood. She shared not just
                  her flowers, but her time, her stories, and her incredible spirit. The community
                  has lost a true treasure.
                </p>
                <div class="entry-actions">
                  <button class="action-btn"><i class="fas fa-heart"></i> 32</button>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </section>

    <!-- Footer -->
    <footer role="contentinfo">
      <div class="footer-container">
        <div class="footer-section">
          <h4>Tayvu</h4>
          <p>Creating beautiful digital tributes to celebrate lives and preserve memories.</p>
          <div class="social-links">
            <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
            <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
          </div>
        </div>

        <div class="footer-section">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="#home" data-page="home">Home</a></li>
            <li><a href="#about" data-page="about">About Us</a></li>
            <li><a href="#pricing" data-page="pricing">Pricing</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h4>Support</h4>
          <ul>
            <li><a href="#">Help Center</a></li>
            <li><a href="#">Contact Us</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Terms of Service</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h4>Contact</h4>
          <ul>
            <li><i class="fas fa-envelope"></i> support@tayvu.com</li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2025 Tayvu, LLC. All rights reserved. Made with love for those we remember.</p>
      </div>
    </footer>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Sign In Modal -->
    <div id="signinModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Sign In</h2>
          <button class="close-modal" onclick="closeModal('signin')">&times;</button>
        </div>
        <form id="signinForm">
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" required />
            <span class="form-error" id="emailError">Please enter a valid email</span>
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required />
            <span class="form-error" id="passwordError">Password is required</span>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="showSignUp()">
              Create Account
            </button>
            <button type="submit" class="btn-primary">Sign In</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Sign Up Modal -->
    <div id="signupModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Create Account</h2>
          <button class="close-modal" onclick="closeModal('signup')">&times;</button>
        </div>
        <form id="signupForm">
          <div class="form-group">
            <label for="signupName">Full Name</label>
            <input type="text" id="signupName" name="name" required />
          </div>
          <div class="form-group">
            <label for="signupEmail">Email</label>
            <input type="email" id="signupEmail" name="email" required />
          </div>
          <div class="form-group">
            <label for="signupPassword">Password</label>
            <input type="password" id="signupPassword" name="password" required minlength="6" />
          </div>
          <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="showSignIn()">
              Already have account
            </button>
            <button type="submit" class="btn-primary">Create Account</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Supabase Configuration - Professional Implementation
      let supabase = null;
      let configCache = null;
      let isInitialized = false; // Add flag to prevent duplicate initialization
      const FUNCTIONS_URL = '/.netlify/functions';

      // Get Supabase configuration with caching
      async function getSupabaseConfig() {
        // Check session storage cache first
        const cached = sessionStorage.getItem('supabase_config');
        if (cached) {
          return JSON.parse(cached);
        }

        try {
          const response = await fetch(`${FUNCTIONS_URL}/get-config`);
          if (!response.ok) {
            throw new Error(`Config fetch failed: ${response.status}`);
          }

          const config = await response.json();

          // Validate config has required fields
          if (!config.supabaseUrl || !config.supabaseAnonKey) {
            throw new Error('Invalid configuration received');
          }

          // Cache for this session
          sessionStorage.setItem('supabase_config', JSON.stringify(config));

          return config;
        } catch (error) {
          console.error('Configuration error:', error);
          throw new Error('Unable to load application configuration');
        }
      }

      // Initialize the app with proper error handling and auth state management
      async function initializeApp() {
        // Prevent duplicate initialization
        if (isInitialized) {
          console.log('App already initialized, skipping...');
          return;
        }

        try {
          // Show loading state (optional - add a loading indicator to your UI)
          console.log('Initializing application...');

          // Get config (cached after first load)
          const config = await getSupabaseConfig();

          // Initialize Supabase client with enhanced options
          const { createClient } = window.supabase;
          supabase = createClient(config.supabaseUrl, config.supabaseAnonKey, {
            auth: {
              persistSession: true,
              autoRefreshToken: true,
              detectSessionInUrl: true,
              storageKey: 'tayvu-auth-token',
              storage: window.localStorage
            }
          });

          // Set up auth state listener for real-time auth changes
          supabase.auth.onAuthStateChange((event, session) => {
            console.log('Auth state changed:', event);

            if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {
              currentUser = session.user;
              updateAuthUI(true);
            } else if (event === 'SIGNED_OUT') {
              currentUser = null;
              updateAuthUI(false);
            } else if (event === 'USER_UPDATED') {
              currentUser = session.user;
              // Refresh any user-specific UI elements
              if (currentPage === 'profile') {
                loadProfileData();
              }
            }
          });

          // Check for existing session
          const {
            data: { session },
            error
          } = await supabase.auth.getSession();
          if (error) {
            console.error('Session check error:', error);
          } else if (session) {
            currentUser = session.user;
            updateAuthUI(true);
            console.log('Restored existing session for:', session.user.email);
          }

          console.log('App initialized successfully');
          isInitialized = true; // Set flag
        } catch (error) {
          console.error('Failed to initialize app:', error);
          showNotification('Failed to load application. Please refresh the page.', 'error');

          // Show a retry button if initialization fails
          const retryButton = document.createElement('button');
          retryButton.textContent = 'Retry';
          retryButton.onclick = () => location.reload();
          retryButton.style.cssText = 'position: fixed; top: 80px; right: 20px; z-index: 9999;';
          document.body.appendChild(retryButton);
        }
      }

      // Call initialization when page loads with proper error handling
      // Call initialization when page loads with proper error handling
      window.addEventListener('load', () => {
        // Only initialize once
        if (!window.appInitialized) {
          window.appInitialized = true;
          initializeApp().catch((error) => {
            console.error('Critical initialization error:', error);
          });
        }
      });

      // State management
      let currentUser = null;
      let currentPage = 'home';

      // Navigation scroll effect
      window.addEventListener('scroll', () => {
        const nav = document.querySelector('nav');
        if (window.scrollY > 50) {
          nav.classList.add('scrolled');
        } else {
          nav.classList.remove('scrolled');
        }
      });

      // Navigation functions
      function showPage(page) {
        // Add protection for profile page
        if (page === 'profile' && !currentUser) {
          showNotification('Please sign in to view your profile');
          openModal('signin');
          return;
        }

        // Hide all pages
        document.querySelectorAll('.page-section').forEach((section) => {
          section.classList.remove('active');
        });

        // Show selected page
        const pageElement = document.getElementById(page);
        if (pageElement) {
          pageElement.classList.add('active');
        }

        currentPage = page;

        // Update URL without reload
        history.pushState(null, '', `#${page}`);

        // Scroll to top
        window.scrollTo(0, 0);

        // Load profile data when showing profile page
        if (page === 'profile' && currentUser) {
          loadProfileData();
        }
      }

      function scrollToExample() {
        document.getElementById('example').scrollIntoView({ behavior: 'smooth' });
      }

      // Memorial page functions

      function shareMemorial() {
        if (navigator.share) {
          navigator.share({
            title: 'Margaret Rose Thompson Memorial',
            text: 'Visit the memorial page for Margaret Rose Thompson',
            url: window.location.href
          });
        } else {
          // Copy link to clipboard
          navigator.clipboard.writeText(window.location.href);
          showNotification('Memorial link copied to clipboard!');
        }
      }

      function openMomentModal(card) {
        const img = card.querySelector('img');
        const caption = card.querySelector('.moment-caption').textContent;

        // Create modal for viewing moments
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2>Moment</h2>
                        <button class="close-modal" onclick="this.closest('.modal').remove();">&times;</button>
                    </div>
                    <img src="${img.src}" style="width: 100%; border-radius: 10px; margin-bottom: 1rem;">
                    <p style="text-align: center; color: var(--text-secondary);">${caption}</p>
                </div>
            `;
        document.body.appendChild(modal);
        document.body.style.overflow = 'hidden';

        modal.addEventListener('click', function (e) {
          if (e.target === modal) {
            modal.remove();
            document.body.style.overflow = 'auto';
          }
        });
      }

      function openGuestbookModal() {
        if (!currentUser) {
          showNotification('Please sign in to leave a message');
          openModal('signin');
          return;
        }

        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Leave a Message</h2>
                        <button class="close-modal" onclick="this.closest('.modal').remove(); document.body.style.overflow = 'auto';">&times;</button>
                    </div>
                    <form onsubmit="submitGuestbookEntry(event)">
                        <div class="form-group">
                            <label for="guestbookMessage">Your Message</label>
                            <textarea id="guestbookMessage" name="message" rows="6" required placeholder="Share your memories and condolences..."></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="this.closest('.modal').remove(); document.body.style.overflow = 'auto';">Cancel</button>
                            <button type="submit" class="btn-primary">Post Message</button>
                        </div>
                    </form>
                </div>
            `;
        document.body.appendChild(modal);
        document.body.style.overflow = 'hidden';
      }

      function submitGuestbookEntry(event) {
        event.preventDefault();
        const messageInput = document.getElementById('guestbookMessage');
        const rawMessage = messageInput.value;

        // Sanitize the message
        const sanitizedMessage = MemorialSanitizer.sanitizeMessage(rawMessage);

        if (!sanitizedMessage) {
          showNotification('Please enter a valid message', 'error');
          return;
        }

        // Create entry using DOM methods
        const newEntry = document.createElement('div');
        newEntry.className = 'guestbook-entry';

        // Create header
        const header = document.createElement('div');
        header.className = 'entry-header';

        // Create user image
        const userImg = document.createElement('img');
        userImg.src = currentUser?.photoURL || 'assets/default-avatar.jpg';
        userImg.alt = 'Your profile photo';
        userImg.width = 50;
        userImg.height = 50;
        userImg.onerror = function () {
          this.src = 'assets/default-avatar.jpg';
        };

        // Create info container
        const info = document.createElement('div');
        info.className = 'entry-info';

        const userName = document.createElement('h4');
        userName.textContent = MemorialSanitizer.sanitizeText(
          currentUser?.displayName || 'Anonymous'
        );

        const date = document.createElement('p');
        date.className = 'entry-date';
        date.textContent = 'Just now';

        // Create message paragraph
        const messageEl = document.createElement('p');
        messageEl.className = 'entry-message';
        // Use innerHTML for sanitized content that may contain allowed HTML
        messageEl.innerHTML = sanitizedMessage;

        // Create actions
        const actions = document.createElement('div');
        actions.className = 'entry-actions';

        const likeBtn = document.createElement('button');
        likeBtn.className = 'action-btn';
        likeBtn.innerHTML = '<i class="fas fa-heart"></i> 0';
        likeBtn.onclick = function () {
          incrementLikes(this);
        };

        // Assemble the entry
        info.appendChild(userName);
        info.appendChild(date);
        header.appendChild(userImg);
        header.appendChild(info);
        actions.appendChild(likeBtn);

        newEntry.appendChild(header);
        newEntry.appendChild(messageEl);
        newEntry.appendChild(actions);

        // Add to guestbook
        const guestbookEntries = document.querySelector('.guestbook-entries');
        guestbookEntries.insertBefore(newEntry, guestbookEntries.firstChild);

        // Clear form and close modal
        messageInput.value = '';
        event.target.closest('.modal').remove();
        document.body.style.overflow = 'auto';

        // Show success notification
        showNotification('Your message has been posted');

        // In production, also save to database with sanitized content
        saveGuestbookEntry({
          message: sanitizedMessage,
          userId: currentUser?.uid,
          userName: MemorialSanitizer.sanitizeText(currentUser?.displayName),
          timestamp: new Date().toISOString()
        });
      }

      // Modal functions
      function openModal(type) {
        document.getElementById(`${type}Modal`).style.display = 'block';
        document.body.style.overflow = 'hidden';
      }

      function closeModal(type) {
        document.getElementById(`${type}Modal`).style.display = 'none';
        document.body.style.overflow = 'auto';
      }

      function showSignIn() {
        closeModal('signup');
        openModal('signin');
      }

      function showSignUp() {
        closeModal('signin');
        openModal('signup');
      }

      // Authentication functions

      // Secure API client for server communication
      class SecureAPIClient {
        constructor() {
          this.baseURL = '/.netlify/functions';
          this.token = null;
        }

        async request(endpoint, options = {}) {
          const url = `${this.baseURL}/${endpoint}`;

          const headers = {
            'Content-Type': 'application/json',
            ...options.headers
          };

          if (this.token) {
            headers['Authorization'] = `Bearer ${this.token}`;
          }

          try {
            const response = await fetch(url, {
              ...options,
              headers,
              credentials: 'include'
            });

            const data = await response.json();

            if (!response.ok) {
              throw new APIError(data.error || 'Request failed', response.status, data.field);
            }

            return data;
          } catch (error) {
            if (error instanceof APIError) {
              throw error;
            }
            throw new APIError('Network error', 0);
          }
        }

        setToken(token) {
          this.token = token;
        }
      }

      class APIError extends Error {
        constructor(message, status, field = null) {
          super(message);
          this.status = status;
          this.field = field;
        }
      }

      // Initialize API client
      const apiClient = new SecureAPIClient();

      // expose apiClient to window so modules can see it
      window.apiClient = apiClient;

      // Profile page functions
      function goToProfile() {
        if (!currentUser) {
          openModal('signin');
          return;
        }
        showPage('profile');
        loadProfileData();
      }

      function switchProfileTab(tab) {
        // Update tab buttons
        document.querySelectorAll('.profile-tab').forEach((t) => t.classList.remove('active'));
        event.target.closest('.profile-tab').classList.add('active');

        // Update tab content
        document
          .querySelectorAll('.profile-tab-content')
          .forEach((c) => c.classList.remove('active'));
        document.getElementById(`${tab}Tab`).classList.add('active');
      }

      async function updateProfile(event) {
        event.preventDefault();

        const name = document.getElementById('settingsName').value;

        try {
          const { data, error } = await supabase.auth.updateUser({
            data: { name }
          });

          if (error) throw error;

          // Update displayed name
          document.getElementById('profileName').textContent = name;
          currentUser.user_metadata.name = name;

          showNotification('Profile updated successfully!');
        } catch (error) {
          showNotification('Error updating profile', 'error');
        }
      }

      function uploadProfilePhoto() {
        // Create a file input
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';

        input.onchange = async (e) => {
          const file = e.target.files[0];
          if (!file) return;

          // For demo, just show the selected image
          const reader = new FileReader();
          reader.onload = (e) => {
            document.getElementById('profilePhotoLarge').src = e.target.result;

            // Also update the nav profile photo - ADD THESE 3 LINES
            document.getElementById('navProfilePhoto').src = e.target.result;
            document.getElementById('navProfilePhoto').style.display = 'block';
            document.getElementById('navProfileInitial').style.display = 'none';

            showNotification('Profile photo updated!');
          };
          reader.readAsDataURL(file);

          // In a real app, you would upload to Supabase storage here
        };

        input.click();
      }

      function confirmDeleteAccount() {
        if (
          confirm('Are you sure you want to delete your account? This action cannot be undone.')
        ) {
          // Handle account deletion
          showNotification('Account deletion is not available in demo mode', 'error');
        }
      }

      function viewMemorial(id) {
        // Navigate to memorial page
        showPage('exampleMemorial');
      }

      // Create Memorial Functions
      function validateDates() {
        const birthDateInput = document.getElementById('birthDate');
        const deathDateInput = document.getElementById('deathDate');
        const birthDateError = document.getElementById('birthDateError');
        const deathDateError = document.getElementById('deathDateError');

        // Get today's date in YYYY-MM-DD format
        const today = new Date();
        const todayString = today.toISOString().split('T')[0];

        // Set min and max attributes
        const minDate = '1850-01-01';
        birthDateInput.setAttribute('min', minDate);
        birthDateInput.setAttribute('max', todayString);
        deathDateInput.setAttribute('min', minDate);
        deathDateInput.setAttribute('max', todayString);

        // Reset error messages
        birthDateError.style.display = 'none';
        deathDateError.style.display = 'none';
        birthDateError.textContent = '';
        deathDateError.textContent = '';

        if (birthDateInput.value && deathDateInput.value) {
          const birthDate = new Date(birthDateInput.value);
          const deathDate = new Date(deathDateInput.value);
          const minDateObj = new Date(minDate);

          // Validate birth date
          if (birthDate < minDateObj) {
            birthDateError.textContent = 'Date of birth cannot be before 1850';
            birthDateError.style.display = 'block';
            birthDateInput.setCustomValidity('Invalid date');
            return false;
          } else if (birthDate > today) {
            birthDateError.textContent = 'Date of birth cannot be in the future';
            birthDateError.style.display = 'block';
            birthDateInput.setCustomValidity('Invalid date');
            return false;
          } else {
            birthDateInput.setCustomValidity('');
          }

          // Validate death date
          if (deathDate < minDateObj) {
            deathDateError.textContent = 'Date of passing cannot be before 1850';
            deathDateError.style.display = 'block';
            deathDateInput.setCustomValidity('Invalid date');
            return false;
          } else if (deathDate > today) {
            deathDateError.textContent = 'Date of passing cannot be in the future';
            deathDateError.style.display = 'block';
            deathDateInput.setCustomValidity('Invalid date');
            return false;
          } else if (deathDate <= birthDate) {
            deathDateError.textContent = 'Date of passing must be after date of birth';
            deathDateError.style.display = 'block';
            deathDateInput.setCustomValidity('Invalid date');
            return false;
          } else {
            deathDateInput.setCustomValidity('');

            // Calculate age for additional validation
            const ageAtDeath = (deathDate - birthDate) / (365.25 * 24 * 60 * 60 * 1000);
            if (ageAtDeath > 150) {
              deathDateError.textContent = 'Please verify the dates (age exceeds 150 years)';
              deathDateError.style.display = 'block';
              return false;
            }
          }
        }

        return true;
      }

      let currentStep = 1;
      const totalSteps = 5;
      let memorialData = {
        basic: {},
        story: {},
        services: [],
        moments: [],
        settings: {}
      };

      function goToCreateMemorial() {
        if (!currentUser) {
          openModal('signin');
          return;
        }
        showPage('createMemorial');
        currentStep = 1;

        // Reset all form steps
        document.querySelectorAll('.form-step').forEach((step) => {
          step.classList.remove('active');
        });

        // Show step 1
        document.getElementById('step1').classList.add('active');

        updateProgress();

        // Initialize date validation with proper min/max dates
        setTimeout(() => {
          const today = new Date().toISOString().split('T')[0];
          const minDate = '1850-01-01';

          const birthDateInput = document.getElementById('birthDate');
          const deathDateInput = document.getElementById('deathDate');

          if (birthDateInput) {
            birthDateInput.setAttribute('min', minDate);
            birthDateInput.setAttribute('max', today);
          }

          if (deathDateInput) {
            deathDateInput.setAttribute('min', minDate);
            deathDateInput.setAttribute('max', today);
          }
        }, 100);
      }

      function updateProgress() {
        // Update progress bar
        const progressFill = document.getElementById('progressFill');
        progressFill.style.width = `${(currentStep / totalSteps) * 100}%`;

        // Update step indicators
        document.querySelectorAll('.progress-step').forEach((step, index) => {
          step.classList.remove('active', 'completed');

          if (index < currentStep - 1) {
            step.classList.add('completed');
          } else if (index === currentStep - 1) {
            step.classList.add('active');
          }
        });

        // Hide all form steps
        document.querySelectorAll('.form-step').forEach((step) => {
          step.classList.remove('active');
          step.style.display = 'none';
          step.style.visibility = 'hidden';
        });

        // Show current step
        const currentStepElement = document.getElementById(`step${currentStep}`);
        if (currentStepElement) {
          currentStepElement.classList.add('active');
          currentStepElement.style.display = 'block';
          currentStepElement.style.visibility = 'visible';
        }

        // Scroll to top of form
        window.scrollTo(0, 80); // Account for fixed nav

        // Adjust spacing for non-first steps
        const memorialPage = document.querySelector('.create-memorial-page');
        if (memorialPage) {
          if (currentStep === 1) {
            memorialPage.classList.remove('compact-layout');
          } else {
            memorialPage.classList.add('compact-layout');
          }
        }

        // ADD THIS NEW CODE HERE ‚Üì‚Üì‚Üì

        // Initialize features for specific steps
        if (currentStep === 2) {
          // Initialize rich text auto-save for obituary
          setTimeout(() => {
            initializeRichTextAutoSave();
            loadDraftLifeStory();
          }, 100);
        }

        // ‚Üë‚Üë‚Üë END OF NEW CODE
      } // This is the closing brace of updateProgress()

      function nextStep() {
        if (validateCurrentStep()) {
          saveStepData();
          if (currentStep < totalSteps) {
            // Store the data before moving to next step
            console.log(`Completing step ${currentStep}`);

            currentStep++;
            updateProgress();

            // Ensure the previous step is completely hidden
            if (currentStep > 1) {
              const previousStep = document.getElementById(`step${currentStep - 1}`);
              if (previousStep) {
                previousStep.classList.remove('active');
              }
            }

            if (currentStep === 5) {
              generatePreview();
            }
          }
        }
      }

      function previousStep() {
        if (currentStep > 1) {
          // Ensure current step is hidden
          const currentStepElement = document.getElementById(`step${currentStep}`);
          if (currentStepElement) {
            currentStepElement.classList.remove('active');
          }

          currentStep--;
          updateProgress();
        }
      }

      function skipStep() {
        if (currentStep < totalSteps) {
          currentStep++;
          updateProgress();
        }
      }

      function validateCurrentStep() {
        // Add validation for required fields
        switch (currentStep) {
          case 1:
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const birthDate = document.getElementById('birthDate').value;
            const deathDate = document.getElementById('deathDate').value;
            const headline = document.getElementById('headline').value;
            const openingStatement = document.getElementById('openingStatement').value;

            // Check if all required fields are filled
            if (
              !firstName ||
              !lastName ||
              !birthDate ||
              !deathDate ||
              !headline ||
              !openingStatement
            ) {
              showNotification('Please fill in all required fields', 'error');
              return false;
            }

            // Validate dates using the validateDates function
            if (!validateDates()) {
              return false;
            }

            // Additional date validations
            const birthDateObj = new Date(birthDate);
            const deathDateObj = new Date(deathDate);
            const minDateObj = new Date('1850-01-01');

            // Check if dates are before 1850
            if (birthDateObj < minDateObj) {
              showNotification('Date of birth cannot be before 1850', 'error');
              document.getElementById('birthDate').focus();
              return false;
            }

            if (deathDateObj < minDateObj) {
              showNotification('Date of passing cannot be before 1850', 'error');
              document.getElementById('deathDate').focus();
              return false;
            }

            return true;

          case 2:
            // Validate obituary details
            const lifeStory = document.getElementById('lifeStory').innerHTML;
            const lifeStoryText = document.getElementById('lifeStory').textContent.trim();

            // Check if empty
            if (!lifeStoryText || lifeStoryText.length < 50) {
              showNotification('Please write at least 50 characters for the obituary', 'error');
              document.getElementById('lifeStory').focus();
              return false;
            }

            // Check for suspicious content
            if (lifeStory.includes('<script') || lifeStory.includes('javascript:')) {
              showNotification('Invalid content detected. Please remove any scripts.', 'error');
              return false;
            }

            // Sanitize and check if content survives sanitization
            const sanitized = MemorialSanitizer.sanitizeRichText(lifeStory);
            const sanitizedText = document.createElement('div');
            sanitizedText.innerHTML = sanitized;

            if (sanitizedText.textContent.trim().length < 50) {
              showNotification(
                'The obituary content is too short after removing invalid elements',
                'error'
              );
              return false;
            }

            return true;

          case 3:
            // Service Information - optional step, no validation required
            return true;

          case 4:
            // Cherished Moments - optional step, no validation required
            return true;

          case 5:
            // Preview step - no validation needed
            return true;

          default:
            return true;
        }
      }

      function saveStepData() {
        switch (currentStep) {
          case 1:
            memorialData.basic = {
              firstName: document.getElementById('firstName').value,
              middleName: document.getElementById('middleName').value,
              lastName: document.getElementById('lastName').value,
              birthDate: document.getElementById('birthDate').value,
              deathDate: document.getElementById('deathDate').value,
              headline: document.getElementById('headline').value,
              openingStatement: document.getElementById('openingStatement').value,
              profilePhoto: document.getElementById('profilePhotoPreview').src,
              backgroundPhoto: document.getElementById('backgroundPhotoPreview').src
            };
            break;
          case 2:
            // Get the raw HTML from the editor
            const rawContent = document.getElementById('lifeStory').innerHTML;

            // Sanitize the rich text content
            const sanitizedContent = MemorialSanitizer.sanitizeRichText(rawContent);

            // Validate that content exists
            if (!sanitizedContent || sanitizedContent.trim().length < 50) {
              showNotification('Please write at least 50 characters for the obituary', 'error');
              return false;
            }

            memorialData.story = {
              lifeStory: sanitizedContent,
              // Store both sanitized and raw for editing
              lifeStoryRaw: rawContent,
              // Store plain text version for previews/excerpts
              lifeStoryText: document.getElementById('lifeStory').textContent.trim()
            };
            break;
          case 3:
            // Save service information
            memorialData.services = [];
            document.querySelectorAll('.service-item-form').forEach((form) => {
              const serviceData = {
                type: form.querySelector('[name="serviceType"]').value,
                date: form.querySelector('[name="serviceDate"]').value,
                time: form.querySelector('[name="serviceTime"]').value,
                locationName: form.querySelector('[name="locationName"]').value,
                locationAddress: form.querySelector('[name="locationAddress"]').value
              };
              if (serviceData.type) {
                memorialData.services.push(serviceData);
              }
            });
            memorialData.serviceNote = document.getElementById('serviceNote')?.value || '';
            break;
          case 4:
            // Save moments
            memorialData.moments = moments;
            break;
          case 5:
            // Save privacy settings
            memorialData.settings = {
              privacy: document.querySelector('input[name="privacy"]:checked').value
            };
            break;
        }
      }

      // Add this after the saveStepData function (around line 3000)
      function displayLifeStory(content) {
        // Find the container where obituary should be displayed
        const container = document.querySelector('.obituary-details');
        if (!container) {
          console.error('Obituary container not found');
          return;
        }

        // Content is already sanitized, safe to use innerHTML
        container.innerHTML = content;

        // Also update the headline if provided
        const headlineEl = document.querySelector('.obituary-title');
        if (headlineEl && memorialData.basic && memorialData.basic.headline) {
          // Use textContent for plain text (headline)
          headlineEl.textContent = memorialData.basic.headline;
        }

        // Update the opening statement
        const leadEl = document.querySelector('.obituary-lead');
        if (leadEl && memorialData.basic && memorialData.basic.openingStatement) {
          // Use textContent for plain text
          leadEl.textContent = memorialData.basic.openingStatement;
        }
      }

      // Function to load content back into editor for editing
      function loadLifeStoryForEditing() {
        const editor = document.getElementById('lifeStory');
        if (!editor) return;

        // Load the raw version if available (for editing)
        if (memorialData.story && memorialData.story.lifeStoryRaw) {
          editor.innerHTML = memorialData.story.lifeStoryRaw;
        } else if (memorialData.story && memorialData.story.lifeStory) {
          // Fallback to sanitized version
          editor.innerHTML = memorialData.story.lifeStory;
        }
      }

      function uploadImage(type) {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';

        input.onchange = (e) => {
          const file = e.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            if (type === 'profile') {
              document.getElementById('profilePhotoPreview').src = e.target.result;
              document.getElementById('profilePhotoPreview').style.display = 'block';
              document.querySelector('#profilePhotoUpload .upload-placeholder').style.display =
                'none';
            } else if (type === 'background') {
              document.getElementById('backgroundPhotoPreview').src = e.target.result;
              document.getElementById('backgroundPhotoPreview').style.display = 'block';
              document.querySelector('#backgroundPhotoUpload .upload-placeholder').style.display =
                'none';
            }
          };
          reader.readAsDataURL(file);
        };

        input.click();
      }

      function selectDefaultBackground(imageUrl) {
        // Update the preview
        document.getElementById('backgroundPhotoPreview').src = imageUrl;
        document.getElementById('backgroundPhotoPreview').style.display = 'block';
        document.querySelector('#backgroundPhotoUpload .upload-placeholder').style.display = 'none';

        // Remove selected class from all options
        document.querySelectorAll('.default-bg-option').forEach((option) => {
          option.classList.remove('selected');
        });

        // Add selected class to clicked option
        event.currentTarget.classList.add('selected');

        // Show notification
        showNotification('Background image selected!');
      }

      function formatText(command) {
        document.execCommand(command, false, null);
      }

      function addParagraph() {
        const editor = document.getElementById('lifeStory');
        editor.focus();
        document.execCommand('insertParagraph', false, null);
      }

      function addServiceItem() {
        const serviceHtml = `
        <div class="service-item-form">
            <h3>Service ${document.querySelectorAll('.service-item-form').length + 1}</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>Service Type</label>
                    <select name="serviceType">
                        <option value="">Select type...</option>
                        <option value="viewing">Viewing & Visitation</option>
                        <option value="funeral">Funeral Service</option>
                        <option value="memorial">Memorial Service</option>
                        <option value="celebration">Celebration of Life</option>
                        <option value="reception">Reception</option>
                        <option value="burial">Burial</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" name="serviceDate">
                </div>
                <div class="form-group">
                    <label>Time</label>
                    <input type="time" name="serviceTime">
                </div>
                <div class="form-group">
                    <label>Location Name</label>
                    <input type="text" name="locationName" placeholder="e.g., St. Mary's Church">
                </div>
                <div class="form-group full-width">
                    <label>Address</label>
                    <input type="text" name="locationAddress" placeholder="Full address">
                </div>
            </div>
        </div>
    `;
        document.getElementById('serviceItems').insertAdjacentHTML('beforeend', serviceHtml);
      }

      // Drag and drop for moments
      function handleDragOver(e) {
        e.preventDefault();
        e.currentTarget.classList.add('drag-over');
      }

      function handleDragLeave(e) {
        e.currentTarget.classList.remove('drag-over');
      }

      function handleDrop(e) {
        e.preventDefault();
        e.currentTarget.classList.remove('drag-over');

        const files = Array.from(e.dataTransfer.files);
        files.forEach((file) => {
          if (file.type.startsWith('image/') || file.type.startsWith('video/')) {
            addMoment(file);
          }
        });
      }

      // Moments management
      let moments = [];
      let momentsViewMode = 'grid';

      function selectMoments() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*,video/*';
        input.multiple = true;

        input.onchange = (e) => {
          const files = Array.from(e.target.files);
          files.forEach((file) => addMoment(file));
        };

        input.click();
      }

      function addMoment(file) {
        if (!file.type.startsWith('image/') && !file.type.startsWith('video/')) {
          showNotification('Please upload only images or videos', 'error');
          return;
        }

        if (file.size > 50 * 1024 * 1024) {
          // 50MB limit
          showNotification('File size must be less than 50MB', 'error');
          return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
          const momentId = Date.now() + Math.random();
          const isVideo = file.type.startsWith('video/');

          const moment = {
            id: momentId,
            type: isVideo ? 'video' : 'photo',
            url: e.target.result,
            caption: '',
            date: new Date().toISOString().split('T')[0],
            fileName: file.name
          };

          moments.push(moment);
          updateMomentsDisplay();
          updateMomentsCount();

          showNotification(`${isVideo ? 'Video' : 'Photo'} added successfully!`);
        };
        reader.readAsDataURL(file);
      }

      function updateMomentsDisplay() {
        const grid = document.getElementById('momentsPreviewGrid');
        const emptyState = document.getElementById('momentsEmptyState');

        if (moments.length === 0) {
          emptyState.style.display = 'block';
          grid.innerHTML =
            '<div class="moments-empty-state" id="momentsEmptyState">' +
            emptyState.innerHTML +
            '</div>';
          return;
        }

        grid.innerHTML = moments
          .map(
            (moment, index) => `
        <div class="moment-preview-item ${momentsViewMode === 'list' ? 'list-view' : ''}" 
             data-id="${moment.id}"
             draggable="true"
             ondragstart="handleMomentDragStart(event, ${index})"
             ondragover="handleMomentDragOver(event)"
             ondrop="handleMomentDrop(event, ${index})"
             ondragend="handleMomentDragEnd(event)">
            
            <div class="moment-preview-image">
                ${
                  moment.type === 'video'
                    ? `<video src="${moment.url}" muted></video>
                     <div class="video-indicator-overlay">
                         <i class="fas fa-play"></i>
                     </div>`
                    : `<img src="${moment.url}" alt="${moment.caption || 'Moment'}">`
                }
            </div>
            
            <div class="moment-actions">
                <button class="moment-action-btn moment-edit-btn" 
                        onclick="editMomentCaption(${index})" 
                        title="Edit caption">
                    <i class="fas fa-pen"></i>
                </button>
                <button class="moment-action-btn moment-remove-btn" 
                        onclick="removeMoment(${index})" 
                        title="Remove">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="moment-caption">
                <input type="text" 
                       class="caption-input" 
                       placeholder="Add a caption (optional)" 
                       value="${moment.caption}"
                       onchange="updateMomentCaption(${index}, this.value)">
                ${momentsViewMode === 'grid' ? `<div class="moment-date">${formatDate(moment.date)}</div>` : ''}
            </div>
        </div>
    `
          )
          .join('');
      }

      function updateMomentsCount() {
        const photos = moments.filter((m) => m.type === 'photo').length;
        const videos = moments.filter((m) => m.type === 'video').length;

        document.getElementById('photoCount').textContent = photos;
        document.getElementById('videoCount').textContent = videos;
      }

      function changeGridView(view) {
        momentsViewMode = view;

        // Update button states
        document.querySelectorAll('.view-btn').forEach((btn) => {
          btn.classList.remove('active');
        });
        event.target.closest('.view-btn').classList.add('active');

        // Update grid class
        const grid = document.getElementById('momentsPreviewGrid');
        if (view === 'list') {
          grid.classList.add('list-view');
        } else {
          grid.classList.remove('list-view');
        }

        updateMomentsDisplay();
      }

      function updateMomentCaption(index, caption) {
        moments[index].caption = caption;
      }

      function editMomentCaption(index) {
        const captionInput = event.target
          .closest('.moment-preview-item')
          .querySelector('.caption-input');
        captionInput.focus();
        captionInput.select();
      }

      function removeMoment(index) {
        if (confirm('Are you sure you want to remove this moment?')) {
          moments.splice(index, 1);
          updateMomentsDisplay();
          updateMomentsCount();
          showNotification('Moment removed');
        }
      }

      // Drag and drop for reordering
      let draggedMomentIndex = null;

      function handleMomentDragStart(e, index) {
        draggedMomentIndex = index;
        e.target.classList.add('dragging');
      }

      function handleMomentDragOver(e) {
        e.preventDefault();
        e.currentTarget.classList.add('drag-over');
      }

      function handleMomentDrop(e, dropIndex) {
        e.preventDefault();
        e.currentTarget.classList.remove('drag-over');

        if (draggedMomentIndex !== null && draggedMomentIndex !== dropIndex) {
          // Reorder moments array
          const draggedMoment = moments[draggedMomentIndex];
          moments.splice(draggedMomentIndex, 1);

          if (draggedMomentIndex < dropIndex) {
            moments.splice(dropIndex - 1, 0, draggedMoment);
          } else {
            moments.splice(dropIndex, 0, draggedMoment);
          }

          updateMomentsDisplay();
          showNotification('Moments reordered');
        }
      }

      function handleMomentDragEnd(e) {
        e.target.classList.remove('dragging');
        document.querySelectorAll('.moment-preview-item').forEach((item) => {
          item.classList.remove('drag-over');
        });
        draggedMomentIndex = null;
      }

      function generatePreview() {
        // Save current step data first
        saveStepData();

        // Show notification
        showNotification('Generating preview...');

        // Get the preview iframe element
        const previewFrame = document.getElementById('memorialPreview');
        if (previewFrame) {
          // Hide the iframe completely
          previewFrame.style.display = 'none';

          // Get the parent container
          const previewContainer = previewFrame.parentElement;

          // Remove any existing preview message
          const existingMessage = previewContainer.querySelector('.preview-message');
          if (existingMessage) {
            existingMessage.remove();
          }

          // Create new preview message
          const message = document.createElement('div');
          message.className = 'preview-message';
          message.style.cssText = `
            padding: 3rem;
            text-align: center;
            color: var(--text-secondary);
            background: var(--gradient-soft);
            border-radius: 10px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        `;
          message.innerHTML = `
            <i class="fas fa-eye" style="font-size: 3rem; margin-bottom: 1rem; color: var(--primary-sage);"></i>
            <h3 style="margin-bottom: 1rem;">Memorial Preview Ready</h3>
            <p>Your memorial has been prepared. Click "Publish Memorial" to make it live.</p>
            <button class="btn-secondary" data-page="exampleMemorial" style="margin-top: 1rem;">
                <i class="fas fa-external-link-alt"></i>
                View Example Memorial
            </button>
        `;
          previewContainer.appendChild(message);
        }

        // Log the memorial data for debugging
        console.log('Memorial preview data:', memorialData);
      }

      function previewDevice(device) {
        const frame = document.querySelector('.device-frame');
        switch (device) {
          case 'desktop':
            frame.style.maxWidth = '1200px';
            frame.style.height = '600px';
            break;
          case 'tablet':
            frame.style.maxWidth = '768px';
            frame.style.height = '1024px';
            break;
          case 'mobile':
            frame.style.maxWidth = '375px';
            frame.style.height = '667px';
            break;
        }
      }

      function saveDraft() {
        saveStepData();
        // In a real app, this would save to database
        showNotification('Draft saved successfully!');
      }

      function publishMemorial() {
        // Collect all data
        saveStepData();

        // In a real app, this would:
        // 1. Save to database
        // 2. Generate the memorial page
        // 3. Redirect to the published memorial

        showNotification('Memorial published successfully!');

        // For demo, redirect to profile
        setTimeout(() => {
          goToProfile();
        }, 2000);
      }

      function publishMemorial() {
        // Collect all data
        saveStepData();

        // Clear any drafts
        localStorage.removeItem('tayvu_draft_lifestory');

        // In a real app, this would:
        // 1. Save to database
        // 2. Generate the memorial page
        // 3. Redirect to the published memorial

        showNotification('Memorial published successfully!');

        // For demo, redirect to profile
        setTimeout(() => {
          goToProfile();
        }, 2000);
      }

      // ADD ALL OF THIS AUTO-SAVE CODE HERE ‚Üì‚Üì‚Üì

      // Auto-save draft while typing
      let autoSaveTimer;
      function initializeRichTextAutoSave() {
        const lifeStoryEditor = document.getElementById('lifeStory');
        if (!lifeStoryEditor) return;

        lifeStoryEditor.addEventListener('input', function () {
          // Clear existing timer
          clearTimeout(autoSaveTimer);

          // Set new timer - save after 2 seconds of no typing
          autoSaveTimer = setTimeout(() => {
            const content = lifeStoryEditor.innerHTML;
            const sanitized = MemorialSanitizer.sanitizeRichText(content);

            // Store in localStorage as backup
            localStorage.setItem(
              'tayvu_draft_lifestory',
              JSON.stringify({
                raw: content,
                sanitized: sanitized,
                timestamp: new Date().toISOString()
              })
            );

            console.log('Draft auto-saved');
          }, 2000);
        });
      }

      // Load draft if exists
      function loadDraftLifeStory() {
        const draft = localStorage.getItem('tayvu_draft_lifestory');
        if (!draft) return;

        try {
          const parsed = JSON.parse(draft);
          const editor = document.getElementById('lifeStory');

          if (editor && parsed.raw) {
            // Check if draft is less than 24 hours old
            const draftAge = Date.now() - new Date(parsed.timestamp).getTime();
            const oneDayMs = 24 * 60 * 60 * 1000;

            if (draftAge < oneDayMs) {
              editor.innerHTML = parsed.raw;
              showNotification('Draft restored from previous session');
            } else {
              // Clear old draft
              localStorage.removeItem('tayvu_draft_lifestory');
            }
          }
        } catch (e) {
          console.error('Error loading draft:', e);
          localStorage.removeItem('tayvu_draft_lifestory');
        }
      }

      // ‚Üë‚Üë‚Üë END OF AUTO-SAVE CODE

      function updateAuthUI(isLoggedIn) {
        const signinBtn = document.querySelector('.btn-signin');
        const profileBtn = document.querySelector('.profile-btn');

        if (isLoggedIn) {
          signinBtn.style.display = 'none';
          profileBtn.style.display = 'flex';

          // Update profile button with user info
          if (currentUser) {
            const initial = (currentUser.user_metadata?.name ||
              currentUser.email ||
              'U')[0].toUpperCase();
            document.getElementById('navProfileInitial').textContent = initial;

            // If user has a profile photo, show it
            if (currentUser.user_metadata?.avatar_url) {
              document.getElementById('navProfilePhoto').src = currentUser.user_metadata.avatar_url;
              document.getElementById('navProfilePhoto').style.display = 'block';
              document.getElementById('navProfileInitial').style.display = 'none';
            } else {
              document.getElementById('navProfilePhoto').style.display = 'none';
              document.getElementById('navProfileInitial').style.display = 'block';
            }
          }
        } else {
          signinBtn.style.display = 'inline-flex';
          profileBtn.style.display = 'none';
        }
      }

      // Pricing functions
      function selectPlan(plan) {
        if (!currentUser) {
          showNotification('Please sign in to create a memorial');
          openModal('signin');
          return;
        }

        // In a real app, this would initiate the payment process
        showNotification(`Selected ${plan} plan - Payment integration coming soon!`);
      }

      // Handle back/forward navigation
      window.addEventListener('popstate', () => {
        const page = location.hash.slice(1) || 'home';
        if (
          [
            'home',
            'about',
            'pricing',
            'faq',
            'profile',
            'createMemorial',
            'exampleMemorial'
          ].includes(page)
        ) {
          showPage(page);
        }
      });

      // Close modals when clicking outside
      window.onclick = function (event) {
        if (event.target.classList.contains('modal')) {
          event.target.style.display = 'none';
          document.body.style.overflow = 'auto';
        }
      };

      // Smooth scroll for all anchor links
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener('click', function (e) {
          if (this.getAttribute('href') === '#') return;

          const targetId = this.getAttribute('href').slice(1);
          const targetElement = document.getElementById(targetId);

          if (targetElement && !['home', 'about', 'pricing'].includes(targetId)) {
            e.preventDefault();
            targetElement.scrollIntoView({ behavior: 'smooth' });
          }
        });
      });

      // Add intersection observer for animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -100px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }
        });
      }, observerOptions);

      // Observe all animated elements
      document.querySelectorAll('.animate-fade-in').forEach((el) => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
        observer.observe(el);
      });

      // Initialize page based on URL hash
      const initialPage = location.hash.slice(1) || 'home';
      if (
        [
          'home',
          'about',
          'pricing',
          'faq',
          'profile',
          'createMemorial',
          'exampleMemorial'
        ].includes(initialPage)
      ) {
        showPage(initialPage);
      }

      // Add these functions to your existing JavaScript

      // Filter functionality for Cherished Moments

      // VSCO-style moments functionality
      function loadMoreMemories() {
        showNotification('Loading more memories...');
        // In real implementation, this would load more photos from database
      }

      // Click on moment to view
      document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.moment-vsco').forEach((moment) => {
          moment.addEventListener('click', function () {
            viewMomentDetail(this);
          });
        });
      });

      function viewMomentDetail(momentElement) {
        const img = momentElement.querySelector('img');
        const date = momentElement.querySelector('.moment-date-vsco')?.textContent || '';
        const caption = momentElement.querySelector('.moment-caption-vsco')?.textContent || '';

        // Create modal for viewing moments
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>${caption}</h2>
                <button class="close-modal" onclick="this.closest('.modal').remove(); document.body.style.overflow = 'auto';">&times;</button>
            </div>
            <img src="${img.src}" style="width: 100%; border-radius: 10px; margin-bottom: 1rem;">
            <p style="text-align: center; color: var(--text-secondary);">${date}</p>
        </div>
    `;
        document.body.appendChild(modal);
        document.body.style.overflow = 'hidden';

        modal.addEventListener('click', function (e) {
          if (e.target === modal) {
            modal.remove();
            document.body.style.overflow = 'auto';
          }
        });
      }

      // Update the existing viewMoment function

      // Add like functionality

      // Add video play functionality

      // Add upload functionality
      function uploadMemory() {
        if (!currentUser) {
          showNotification('Please sign in to add memories');
          openModal('signin');
          return;
        }

        // Create upload modal
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <h2>Share a Memory</h2>
                <button class="close-modal" onclick="this.closest('.modal').remove(); document.body.style.overflow = 'auto';">&times;</button>
            </div>
            <form onsubmit="submitMemory(event)">
                <div class="form-group">
                    <label>Upload Photo or Video</label>
                    <input type="file" accept="image/*,video/*" required>
                </div>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" placeholder="Give this memory a title" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea rows="4" placeholder="Share the story behind this memory..." required></textarea>
                </div>
                <div class="form-group">
                    <label>Date (Optional)</label>
                    <input type="date">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="this.closest('.modal').remove(); document.body.style.overflow = 'auto';">Cancel</button>
                    <button type="submit" class="btn-primary">Share Memory</button>
                </div>
            </form>
        </div>
    `;
        document.body.appendChild(modal);
        document.body.style.overflow = 'hidden';
      }

      function submitMemory(event) {
        event.preventDefault();
        showNotification('Memory shared successfully! It will be reviewed before appearing.');
        event.target.closest('.modal').remove();
        document.body.style.overflow = 'auto';
      }

      // Call initialization when showing memorial page
      // Add this to your existing showPage function
      const originalShowPage = showPage;
      showPage = function (page) {
        originalShowPage(page);
        if (page === 'exampleMemorial') {
          setTimeout(initializeMomentsFilters, 100);
        }
      };

      // Ensure proper initialization of create memorial form
      document.addEventListener('DOMContentLoaded', function () {
        // Hide all form steps except the first one on page load
        const formSteps = document.querySelectorAll('.form-step');
        formSteps.forEach((step, index) => {
          if (index !== 0) {
            step.classList.remove('active');
          }
        });
      });
    </script>

    <!-- DOMPurify CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
    <!-- Sanitizer script -->
    <script src="sanitizer.js"></script>
    <script>
      // Initialize the sanitizer when the page loads
      document.addEventListener('DOMContentLoaded', function () {
        // Check if sanitizer already initialized
        if (typeof MemorialSanitizer !== 'undefined' && !window.sanitizerInitialized) {
          window.sanitizerInitialized = true;
          if (!MemorialSanitizer.init()) {
            console.error('Failed to initialize HTML sanitizer');
            // Fallback to basic text content
          }
        }
      });
    </script>

    <script type="module" src="/src/js/main.js"></script>
  </body>
</html>
